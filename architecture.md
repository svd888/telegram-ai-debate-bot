# Архитектура Telegram AI Debate Bot

## Обзор проекта

Telegram-бот с интеграцией нескольких ИИ моделей через OpenRouter и режимом дебатов для повышения точности ответов.

## Используемые ИИ модели через OpenRouter

1. **Google Gemini 3 Pro** - `google/gemini-3-pro`
2. **Claude Opus 4.5** - `anthropic/claude-opus-4.5`
3. **Grok 4.1** - `x-ai/grok-4.1`
4. **ChatGPT 5.1 Reasoning High** - `openai/gpt-5.1-reasoning-high`

## Архитектура системы

### Компоненты

1. **Telegram Bot Handler** - обработка входящих сообщений и команд
2. **OpenRouter Client** - клиент для взаимодействия с API OpenRouter
3. **Debate Manager** - управление процессом дебатов между моделями
4. **Response Aggregator** - агрегация и синтез финального ответа
5. **Database** - хранение истории диалогов и результатов дебатов

### Структура проекта

```
telegram-ai-debate-bot/
├── src/
│   ├── bot/
│   │   ├── __init__.py
│   │   ├── handlers.py          # Обработчики команд и сообщений
│   │   └── keyboards.py         # Клавиатуры для бота
│   ├── ai/
│   │   ├── __init__.py
│   │   ├── openrouter_client.py # Клиент OpenRouter API
│   │   ├── debate_manager.py    # Логика дебатов
│   │   └── models.py            # Конфигурация моделей
│   ├── utils/
│   │   ├── __init__.py
│   │   ├── config.py            # Конфигурация
│   │   └── logger.py            # Логирование
│   └── main.py                  # Точка входа
├── data/
│   └── debates/                 # Сохраненные дебаты
├── .env.example                 # Пример переменных окружения
├── requirements.txt             # Зависимости Python
├── README.md                    # Документация
└── config.yaml                  # Конфигурация моделей и параметров
```

## Режим дебатов

### Алгоритм работы

1. **Инициализация**: Пользователь отправляет вопрос
2. **Раунд 1**: Все 4 модели генерируют независимые ответы
3. **Раунд 2-N**: Каждая модель видит ответы других и может:
   - Согласиться с аргументами
   - Предложить контраргументы
   - Уточнить свою позицию
4. **Синтез**: Финальный ответ формируется на основе консенсуса или наиболее аргументированной позиции

### Параметры дебатов

- **Количество раундов**: 2-5 (настраивается)
- **Температура**: 0.2 (для более точных ответов)
- **Режимы**:
  - `quick` - 2 раунда, быстрый ответ
  - `standard` - 3 раунда, баланс скорости и качества
  - `deep` - 5 раундов, максимальная глубина анализа

## Команды бота

- `/start` - Приветствие и инструкции
- `/ask <вопрос>` - Задать вопрос одной модели
- `/debate <вопрос>` - Запустить режим дебатов
- `/settings` - Настройки (выбор моделей, количество раундов)
- `/history` - История дебатов
- `/help` - Справка

## Технологический стек

- **Python 3.11+**
- **python-telegram-bot** - Telegram Bot API
- **aiohttp** - Асинхронные HTTP запросы
- **pydantic** - Валидация данных
- **PyYAML** - Работа с конфигурацией
- **SQLite/PostgreSQL** - База данных (опционально)

## Безопасность

- API ключи хранятся в переменных окружения
- Валидация входных данных
- Ограничение частоты запросов (rate limiting)
- Логирование всех операций

## Уверенность в архитектуре: 92%

Архитектура основана на проверенных паттернах разработки Telegram-ботов и интеграции с AI API. Единственная неопределенность - точные названия моделей в OpenRouter API, которые будут проверены на следующем этапе.
